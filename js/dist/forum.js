(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{components:()=>j});const a=flarum.reg.get("core","forum/app");var s=t.n(a);const i=flarum.reg.get("core","forum/utils/DiscussionControls");var o=t.n(i);const n=flarum.reg.get("core","common/components/Button");var r=t.n(n);const l=flarum.reg.get("core","common/extend");function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function d(t,e,a){return(e=function(t){var e=function(t){if("object"!=h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var a=e.call(t,"string");if("object"!=h(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const c=flarum.reg.get("core","common/components/Modal");var p=t.n(c);const u=flarum.reg.get("core","common/components/Switch");var g=t.n(u);const b=flarum.reg.get("core","common/utils/Stream");var v=t.n(b);const f=flarum.reg.get("core","common/components/Alert");var I=t.n(f);const N=flarum.reg.get("core","common/components/LoadingIndicator");var w=t.n(N);function S(t){if(""==t)return!0;const e=t.split(",");let a=!0;for(let t of e)if(t.split(" ").length>4){a=!1;break}return a}function C(t){var e,a,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t)if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(a=C(t[e]))&&(s&&(s+=" "),s+=a)}else for(a in t)t[a]&&(s&&(s+=" "),s+=a);return s}flarum.reg.add("vadkuz-flarum2-seo","admin/utils/countKeywords",S);const T=function(){for(var t,e,a=0,s="",i=arguments.length;a<i;a++)(t=arguments[a])&&(e=C(t))&&(s&&(s+=" "),s+=e);return s};class _ extends(p()){constructor(){super(...arguments),d(this,"initialized",!0),d(this,"initialLoading",!1)}trans(t,e){return void 0===e&&(e={}),app.translator.trans("vadkuz-flarum2-seo.forum.meta_modal.".concat(t),e)}oninit(t){if(super.oninit(t),this.attrs.object){if(!this.attrs.object.seoMeta)return this.initialized=!1,app.alerts.show(I(),{type:"error",title:this.trans("alerts.unsupported_object_title"),controls:[m("a",{class:"Button Button--link",href:"https://github.com/vadkuz/flarum2-seo",target:"_blank"},this.trans("alerts.documentation_button"))]},this.trans("alerts.unsupported_object_body")),void setTimeout((()=>{this.hide()}),100);this.meta=this.attrs.object.seoMeta()}else this.initializeLoad();this.hasChanges=!1,this.closeText=this.trans("buttons.close"),this.closeInfoText=null,this.loading=!1,this.enableCustomTwitter=!1,this.enableCustomOpenGraph=!1,this.wasManaged=!0,this.seoTagsOpened=!1,this.initializeData()}initializeData(){this.meta&&(this.autoUpdateData=v()(this.meta.autoUpdateData()),this.wasManaged=!0===this.meta.autoUpdateData(),this.metaTitle=v()(this.meta.title()),this.description=v()(this.meta.description()),this.keywords=v()(this.meta.keywords()),this.robotsNoindex=v()(this.meta.robotsNoindex()),this.robotsNofollow=v()(this.meta.robotsNofollow()),this.robotsNoarchive=v()(this.meta.robotsNoarchive()),this.robotsNoimageindex=v()(this.meta.robotsNoimageindex()),this.robotsNosnippet=v()(this.meta.robotsNosnippet()),this.twitterTitle=v()(this.meta.twitterTitle()),this.twitterDescription=v()(this.meta.twitterDescription()),this.twitterImage=v()(this.meta.twitterImage()),this.twitterImageSource=v()(this.meta.twitterImageSource()),this.openGraphTitle=v()(this.meta.openGraphTitle()),this.openGraphDescription=v()(this.meta.openGraphDescription()),this.openGraphImage=v()(this.meta.openGraphImage()),this.openGraphImageSource=v()(this.meta.openGraphImageSource()),this.estimatedReadingTime=v()(this.meta.estimatedReadingTime()),this.createdAt=v()(this.meta.createdAt()),this.updatedAt=v()(this.meta.updatedAt()),this.enableCustomTwitter=null!==this.twitterTitle()||null!==this.twitterDescription()||"auto"!==this.twitterImageSource(),this.enableCustomOpenGraph=null!==this.openGraphTitle()||null!==this.openGraphDescription())}title(){return this.trans("title")}className(){return"Modal Modal-SEO-settings"}initializeLoad(){this.initialLoading=!0,app.store.find("seo_meta","".concat(this.attrs.objectType,"-").concat(this.attrs.objectId)).then((t=>{this.isLoading=!1,this.meta=t,this.initialLoading=!1,this.initializeData()})).then((()=>{m.redraw()}))}content(){var t,e;return!this.initialized||this.initialLoading?m("div",null,w().component({})):m("div",null,m("div",{className:"Modal-body",onkeyup:()=>this.updateHasChanges()},m("div",{className:"Form"},m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("auto_update.title")),m("div",{className:"helpText"},this.trans("auto_update.help"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},g().component({state:this.autoUpdateData(),onchange:t=>{this.autoUpdateData(t),this.updateHasChanges()}},this.trans("auto_update.toggle"))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("meta_title.title")),m("div",{className:"helpText"},this.trans("meta_title.help"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.metaTitle,placeholder:this.trans("placeholders.page_title"),disabled:this.autoUpdateData()}),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," ",this.trans("managed"))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("meta_description.title")),m("div",{className:"helpText"},this.trans("meta_description.help"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("textarea",{className:"FormControl",bidi:this.description,placeholder:this.trans("placeholders.meta_description"),disabled:this.autoUpdateData()}),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," ",this.trans("managed"))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("keywords.title")),m("div",{className:"helpText"},this.trans("keywords.help"))),m("div",{className:"SeoItemContent"},m("textarea",{className:"FormControl",bidi:this.keywords,placeholder:this.trans("placeholders.keywords")}),m("div",{className:T("SeoItemContent-helpertext",0==S(null!=(t=this.keywords())?t:"")&&"invalid")},m("b",null,this.trans("keywords.note"))," ",this.trans("keywords.example_prefix")," ",m("i",null,this.trans("keywords.example_values"))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("meta_image.title")),m("div",{className:"helpText"},this.trans("meta_image.help"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.openGraphImage,placeholder:this.trans("placeholders.image_url"),disabled:this.autoUpdateData()&&"auto"===this.openGraphImageSource()}),this.autoUpdateData()&&"custom"!==this.openGraphImageSource()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," ",this.trans("managed")),!this.autoUpdateData()&&this.returnFoFUploadButton((t=>{this.openGraphImage(t),this.openGraphImageSource("fof-upload")})),"auto"!==this.openGraphImageSource()&&"custom"!==this.openGraphImageSource()&&m("div",{className:"SeoItemContent-helpertext"},this.trans("meta_image.managed_by",{source:this.openGraphImageSource()}))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("robots.title")),m("div",{className:"helpText"},this.trans("robots.help"))),m("div",{className:"SeoItemContent"},m("div",{class:T("SeoTags-dropdown-container",this.seoTagsOpened&&"SeoTags-dropdown-open")},m("div",{className:"SeoTags",onclick:()=>this.seoTagsOpened=!this.seoTagsOpened},this.returnTag(!this.robotsNoindex(),this.trans("robots.tags.allow_indexing"),this.trans("robots.tags.disallow_indexing")),this.returnTag(!this.robotsNofollow(),this.trans("robots.tags.allow_follow"),this.trans("robots.tags.disallow_follow")),this.robotsNoarchive()&&this.returnTag(!1,"",this.trans("robots.tags.disallow_archive")),this.robotsNoimageindex()&&this.returnTag(!1,"",this.trans("robots.tags.disallow_image_indexing")),this.robotsNosnippet()&&this.returnTag(!1,"",this.trans("robots.tags.disallow_snippets"))),m("div",{className:"SeoTags-dropdown"},g().component({state:!this.robotsNoindex(),onchange:t=>{this.robotsNoindex(!t),this.updateHasChanges()}},this.trans("robots.switches.allow_indexing")),g().component({state:!this.robotsNofollow(),onchange:t=>{this.robotsNofollow(!t),this.updateHasChanges()}},this.trans("robots.switches.allow_follow")),g().component({state:this.robotsNoarchive(),onchange:t=>{this.robotsNoarchive(t),this.updateHasChanges()}},this.trans("robots.switches.noarchive")),g().component({state:this.robotsNoimageindex(),onchange:t=>{this.robotsNoimageindex(t),this.updateHasChanges()}},this.trans("robots.switches.noimageindex")),g().component({state:this.robotsNosnippet(),onchange:t=>{this.robotsNosnippet(t),this.updateHasChanges()}},this.trans("robots.switches.nosnippet")))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("reading_time.title")),m("div",{className:"helpText"},this.trans("reading_time.help"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.estimatedReadingTime,placeholder:this.trans("placeholders.reading_time_seconds"),type:"number",disabled:this.autoUpdateData()}),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," ",this.trans("managed"))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("twitter_card.title"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},g().component({state:!this.enableCustomTwitter,onchange:t=>{this.enableCustomTwitter=!t,this.updateHasChanges()},disabled:this.autoUpdateData()},this.trans("twitter_card.auto_generate")),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," ",this.trans("managed"))))),this.enableCustomTwitter&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("twitter_card.twitter_title"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.twitterTitle,placeholder:this.metaTitle(),disabled:this.autoUpdateData()})))),this.enableCustomTwitter&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("twitter_card.twitter_description"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("textarea",{className:"FormControl",bidi:this.twitterDescription,placeholder:this.description(),disabled:this.autoUpdateData()})))),this.enableCustomTwitter&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("twitter_card.twitter_image")),m("div",{className:"helpText"},this.trans("twitter_card.image_help"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.twitterImage,placeholder:null!=(e=this.openGraphImage())?e:this.trans("placeholders.image_url"),disabled:this.autoUpdateData()&&"auto"===this.twitterImage()}),this.returnFoFUploadButton((t=>{this.twitterImage(t),this.twitterImageSource("fof-upload")})),"auto"!==this.twitterImageSource()&&"custom"!==this.twitterImageSource()&&m("div",{className:"SeoItemContent-helpertext"},this.trans("twitter_card.managed_by",{source:this.twitterImageSource()})," ",m("a",{href:"#",onclick:t=>{t.preventDefault(),this.twitterImage(null),this.twitterImageSource("auto"),this.updateHasChanges()}},this.trans("actions.reset_image")))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("open_graph.title"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},g().component({state:!this.enableCustomOpenGraph,onchange:t=>{this.enableCustomOpenGraph=!t,this.updateHasChanges()},disabled:this.autoUpdateData()},this.trans("open_graph.auto_generate")),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," ",this.trans("managed"))))),this.enableCustomOpenGraph&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("open_graph.open_graph_title"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.openGraphTitle,placeholder:this.metaTitle(),disabled:this.autoUpdateData()})))),this.enableCustomOpenGraph&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},this.trans("open_graph.open_graph_description"))),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("textarea",{className:"FormControl",bidi:this.openGraphDescription,placeholder:this.trans("placeholders.custom_twitter_description"),disabled:this.autoUpdateData()})))))),m("div",{style:"padding: 25px 30px; text-align: center;"},this.closeInfoText&&m("div",{style:"margin-bottom: 15px; font-size: 12px;"},m("b",null,this.trans("notices.note_label"))," ",this.closeInfoText),this.closeDialogButton()))}returnFoFUploadButton(t){var e,a,s;let i=null;const o=null==(e=flarum.extensions)?void 0:e["fof-upload"],n=null==o||null==(a=o.components)?void 0:a.Uploader,l=null==o||null==(s=o.components)?void 0:s.FileManagerModal;if("fof-upload"in flarum.extensions&&app.forum.attribute("fof-upload.canUpload")&&n&&l){const e=new n;i=m(r(),{class:"UploadButton Button",onclick:async()=>{app.modal.show(l,{uploader:e,onSelect:e=>{const a=app.store.getById("files",e[0]);t(a.url()),this.updateHasChanges()}},!0)}},this.trans("buttons.upload_file"))}return i}returnTag(t,e,a){return m("div",{className:T("SeoTag",!t&&"SeoTagDisabled")},t?e:a)}closeDialogButton(){return m(r(),{type:"submit",className:"Button Button--primary",loading:this.loading},this.closeText)}updateHasChanges(){this.closeText=!this.wasManaged&&this.autoUpdateData()?this.trans("buttons.save_autofill"):this.trans("buttons.save"),!this.wasManaged&&this.autoUpdateData()?this.closeInfoText=this.trans("notices.autofill_warning"):this.closeInfoText=null,this.hasChanges=!0}submitData(){let t={};var e,a,s,i,o,n,r,m,l;return t.autoUpdateData=this.autoUpdateData(),t.title=this.metaTitle(),t.description=this.description(),""!==this.keywords()&&(t.keywords=null!=(e=this.keywords())?e:null),t.robotsNoindex=this.robotsNoindex(),t.robotsNofollow=this.robotsNofollow(),t.robotsNoarchive=this.robotsNoarchive(),t.robotsNoimageindex=this.robotsNoimageindex(),t.robotsNosnippet=this.robotsNosnippet(),""!==this.twitterTitle()&&(t.twitterTitle=null!=(a=this.twitterTitle())?a:null),""!==this.twitterDescription()&&(t.twitterDescription=null!=(s=this.twitterDescription())?s:null),""!==this.twitterImage()&&(t.twitterImage=this.twitterImage()),"auto"!==this.twitterImageSource()&&(t.twitterImageSource=null!=(i=this.twitterImageSource())?i:null),""!==this.openGraphTitle()&&(t.openGraphTitle=null!=(o=this.openGraphTitle())?o:null),""!==this.openGraphDescription()&&(t.openGraphDescription=null!=(n=this.openGraphDescription())?n:null),""!==this.openGraphImage()&&(t.openGraphImage=null!=(r=this.openGraphImage())?r:null),"auto"!==this.openGraphImageSource()&&(t.openGraphImageSource=null!=(m=this.openGraphImageSource())?m:null),""!==this.estimatedReadingTime()&&(t.estimatedReadingTime=null!=(l=this.estimatedReadingTime())?l:null),t}onsubmit(t){t.preventDefault(),this.hasChanges?(this.loading=!0,this.meta.save(this.submitData()).then((()=>{app.alerts.show({type:"success"},this.trans("alerts.saved")),this.hide()})).catch((t=>{console.log(t)})).then((()=>{this.saving=!1,m.redraw()}))):this.hide()}onsaved(){this.hide()}}flarum.reg.add("vadkuz-flarum2-seo","common/Components/MetaSeoModal",_);const x=flarum.reg.get("core","common/Model");var y=t.n(x);const D=flarum.reg.get("core","common/utils/mixin");var G=t.n(D);class M extends(G()(y(),{objectType:y().attribute("objectType"),objectId:y().attribute("objectId"),autoUpdateData:y().attribute("autoUpdateData"),title:y().attribute("title"),description:y().attribute("description"),keywords:y().attribute("keywords"),robotsNoindex:y().attribute("robotsNoindex"),robotsNofollow:y().attribute("robotsNofollow"),robotsNoarchive:y().attribute("robotsNoarchive"),robotsNoimageindex:y().attribute("robotsNoimageindex"),robotsNosnippet:y().attribute("robotsNosnippet"),twitterTitle:y().attribute("twitterTitle"),twitterDescription:y().attribute("twitterDescription"),twitterImage:y().attribute("twitterImage"),twitterImageSource:y().attribute("twitterImageSource"),openGraphTitle:y().attribute("openGraphTitle"),openGraphDescription:y().attribute("openGraphDescription"),openGraphImage:y().attribute("openGraphImage"),openGraphImageSource:y().attribute("openGraphImageSource"),estimatedReadingTime:y().attribute("estimatedReadingTime"),createdAt:y().attribute("createdAt"),updatedAt:y().attribute("updatedAt")})){apiEndpoint(){return"/seo_meta"+(this.exists?"/"+this.data.id:"")}}flarum.reg.add("vadkuz-flarum2-seo","common/Models/SeoMeta",M);const k=flarum.reg.get("core","common/models/Discussion");var U=t.n(k);const j={MetaSeoModal:_};s().initializers.add("vadkuz-flarum2-seo",(()=>{(0,l.extend)(o(),"moderationControls",(function(t,e){s().forum.attribute("canConfigureSeo")&&t.add("manageSeo",r().component({icon:"fas fa-search",onclick:()=>s().modal.show(_,{objectType:"discussions",objectId:e.id()})},s().translator.trans("vadkuz-flarum2-seo.forum.controls.configure_seo")),-1e3)})),s().store.models.seoMeta=M,s().store.models.seo_meta=M,U().prototype.seoMeta=y().hasOne("seoMeta")}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map