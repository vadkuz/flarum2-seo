(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{components:()=>O});const a=flarum.reg.get("core","forum/app");var o=t.n(a);const i=flarum.reg.get("core","forum/utils/DiscussionControls");var s=t.n(i);const n=flarum.reg.get("core","common/components/Button");var r=t.n(n);const l=flarum.reg.get("core","common/extend");function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function c(t,e,a){return(e=function(t){var e=function(t){if("object"!=d(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var a=e.call(t,"string");if("object"!=d(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==d(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const h=flarum.reg.get("core","common/components/Modal");var p=t.n(h);const u=flarum.reg.get("core","common/components/Switch");var g=t.n(u);const b=flarum.reg.get("core","common/utils/Stream");var f=t.n(b);const v=flarum.reg.get("core","common/components/Alert");var I=t.n(v);const N=flarum.reg.get("core","common/components/LoadingIndicator");var w=t.n(N);function S(t){if(""==t)return!0;const e=t.split(",");let a=!0;for(let t of e)if(t.split(" ").length>4){a=!1;break}return a}function T(t){var e,a,o="";if("string"==typeof t||"number"==typeof t)o+=t;else if("object"==typeof t)if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(a=T(t[e]))&&(o&&(o+=" "),o+=a)}else for(a in t)t[a]&&(o&&(o+=" "),o+=a);return o}flarum.reg.get("core","common/components/FieldSet"),flarum.reg.add("vadkuz-flarum2-seo","admin/utils/countKeywords",S);const C=function(){for(var t,e,a=0,o="",i=arguments.length;a<i;a++)(t=arguments[a])&&(e=T(t))&&(o&&(o+=" "),o+=e);return o};class x extends(p()){constructor(){super(...arguments),c(this,"initialized",!0),c(this,"initialLoading",!1)}oninit(t){if(super.oninit(t),this.attrs.object){if(!this.attrs.object.seoMeta)return this.initialized=!1,app.alerts.show(I(),{type:"error",title:"This object is not a supported SeoMeta object",controls:[m("a",{class:"Button Button--link",href:"https://github.com/vadkuz/flarum2-seo",target:"_blank"},"Documentation")]},"Please open this dialog using the objectType and objectId properties or register the object relationship instead."),void setTimeout((()=>{this.hide()}),100);this.meta=this.attrs.object.seoMeta()}else this.initializeLoad();this.hasChanges=!1,this.closeText="Close",this.closeInfoText=null,this.loading=!1,this.enableCustomTwitter=!1,this.enableCustomOpenGraph=!1,this.wasManaged=!0,this.seoTagsOpened=!1,this.initializeData()}initializeData(){this.meta&&(this.autoUpdateData=f()(this.meta.autoUpdateData()),this.wasManaged=!0===this.meta.autoUpdateData(),this.metaTitle=f()(this.meta.title()),this.description=f()(this.meta.description()),this.keywords=f()(this.meta.keywords()),this.robotsNoindex=f()(this.meta.robotsNoindex()),this.robotsNofollow=f()(this.meta.robotsNofollow()),this.robotsNoarchive=f()(this.meta.robotsNoarchive()),this.robotsNoimageindex=f()(this.meta.robotsNoimageindex()),this.robotsNosnippet=f()(this.meta.robotsNosnippet()),this.twitterTitle=f()(this.meta.twitterTitle()),this.twitterDescription=f()(this.meta.twitterDescription()),this.twitterImage=f()(this.meta.twitterImage()),this.twitterImageSource=f()(this.meta.twitterImageSource()),this.openGraphTitle=f()(this.meta.openGraphTitle()),this.openGraphDescription=f()(this.meta.openGraphDescription()),this.openGraphImage=f()(this.meta.openGraphImage()),this.openGraphImageSource=f()(this.meta.openGraphImageSource()),this.estimatedReadingTime=f()(this.meta.estimatedReadingTime()),this.createdAt=f()(this.meta.createdAt()),this.updatedAt=f()(this.meta.updatedAt()),this.enableCustomTwitter=null!==this.twitterTitle()||null!==this.twitterDescription()||"auto"!==this.twitterImageSource(),this.enableCustomOpenGraph=null!==this.openGraphTitle()||null!==this.openGraphDescription())}title(){return"SEO settings - Meta"}className(){return"Modal Modal-SEO-settings"}initializeLoad(){this.initialLoading=!0,app.store.find("seo_meta","".concat(this.attrs.objectType,"-").concat(this.attrs.objectId)).then((t=>{this.isLoading=!1,this.meta=t,this.initialLoading=!1,this.initializeData()})).then((()=>{m.redraw()}))}content(){var t,e;return!this.initialized||this.initialLoading?m("div",null,w().component({})):m("div",null,m("div",{className:"Modal-body",onkeyup:()=>this.updateHasChanges()},m("div",{className:"Form"},m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Auto update meta tags"),m("div",{className:"helpText"},"When enabled, this items meta tags are automatically updated when the object changes.")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},g().component({state:this.autoUpdateData(),onchange:t=>{this.autoUpdateData(t),this.updateHasChanges()}},"Update object SEO on change")))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Meta title"),m("div",{className:"helpText"},"Title in search engines.")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.metaTitle,placeholder:"Enter page title",disabled:this.autoUpdateData()}),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," Managed")))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"}," Meta description"),m("div",{className:"helpText"},"Describes the item and shown in search engines.")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("textarea",{className:"FormControl",bidi:this.description,placeholder:"Add a few keywords",disabled:this.autoUpdateData()}),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," Managed")))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Keywords"),m("div",{className:"helpText"},"Enter one or more keywords that describes this item.")),m("div",{className:"SeoItemContent"},m("textarea",{className:"FormControl",bidi:this.keywords,placeholder:"Add a few keywords"}),m("div",{className:C("SeoItemContent-helpertext",0==S(null!=(t=this.keywords())?t:"")&&"invalid")},m("b",null,"Note: Separate keywords with a comma.")," Example:"," ",m("i",null,"flarum, web development, forum, apples, security")))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Meta image"),m("div",{className:"helpText"},"Displays an image.")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.openGraphImage,placeholder:"Enter image URL",disabled:this.autoUpdateData()&&"auto"===this.openGraphImageSource()}),this.autoUpdateData()&&"custom"!==this.openGraphImageSource()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," Managed"),!this.autoUpdateData()&&this.returnFoFUploadButton((t=>{this.openGraphImage(t),this.openGraphImageSource("fof-upload")})),"auto"!==this.openGraphImageSource()&&"custom"!==this.openGraphImageSource()&&m("div",{className:"SeoItemContent-helpertext"},"Image source managed by ",this.openGraphImageSource())))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Robots"),m("div",{className:"helpText"},"Robot-crawling settings for this item.")),m("div",{className:"SeoItemContent"},m("div",{class:C("SeoTags-dropdown-container",this.seoTagsOpened&&"SeoTags-dropdown-open")},m("div",{className:"SeoTags",onclick:()=>this.seoTagsOpened=!this.seoTagsOpened},this.returnTag(!this.robotsNoindex(),"Allow indexing page","Page indexing not allowed"),this.returnTag(!this.robotsNofollow(),"Allow follow links","Link following not allowed"),this.robotsNoarchive()&&this.returnTag(!1,"","Archiving pages not allowed"),this.robotsNoimageindex()&&this.returnTag(!1,"","Image indexing not allowed"),this.robotsNosnippet()&&this.returnTag(!1,"","Taking text-snippets not allowed")),m("div",{className:"SeoTags-dropdown"},g().component({state:!this.robotsNoindex(),onchange:t=>{this.robotsNoindex(!t),this.updateHasChanges()}},"Allow indexing page"),g().component({state:!this.robotsNofollow(),onchange:t=>{this.robotsNofollow(!t),this.updateHasChanges()}},"Allow following links to different pages"),g().component({state:this.robotsNoarchive(),onchange:t=>{this.robotsNoarchive(t),this.updateHasChanges()}},"Disable archiving page (noarchive)"),g().component({state:this.robotsNoimageindex(),onchange:t=>{this.robotsNoimageindex(t),this.updateHasChanges()}},"Disable indexing images on this page (noimageindex)"),g().component({state:this.robotsNosnippet(),onchange:t=>{this.robotsNosnippet(t),this.updateHasChanges()}},"Disable text-snippes on page (nosnippet)"))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Estimated reading time"),m("div",{className:"helpText"},"Estimated reading time in seconds.")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.estimatedReadingTime,placeholder:"Reading time in seconds",type:"number",disabled:this.autoUpdateData()}),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," Managed")))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Twitter card")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},g().component({state:!this.enableCustomTwitter,onchange:t=>this.enableCustomTwitter=!t,disabled:this.autoUpdateData()},"Auto generate Twitter card"),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," Managed")))),this.enableCustomTwitter&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Twitter title")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.twitterTitle,placeholder:this.metaTitle(),disabled:this.autoUpdateData()})))),this.enableCustomTwitter&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Twitter description")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("textarea",{className:"FormControl",bidi:this.twitterDescription,placeholder:this.description(),disabled:this.autoUpdateData()})))),this.enableCustomTwitter&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Twitter image"),m("div",{className:"helpText"},"Displays an image on Twitter.")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.twitterImage,placeholder:null!=(e=this.openGraphImage())?e:"Enter image URL",disabled:this.autoUpdateData()&&"auto"===this.twitterImage()}),this.returnFoFUploadButton((t=>{this.twitterImage(t),this.twitterImageSource("fof-upload")})),"auto"!==this.twitterImageSource()&&"custom"!==this.twitterImageSource()&&m("div",{className:"SeoItemContent-helpertext"},"Image source managed by ",this.twitterImageSource()," -"," ",m("a",{href:"#",onclick:t=>{t.preventDefault(),this.twitterImage(null),this.twitterImageSource("auto"),this.updateHasChanges()}},"Reset image"))))),m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Open Graph tags")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},g().component({state:!this.enableCustomOpenGraph,onchange:t=>this.enableCustomOpenGraph=!t,disabled:this.autoUpdateData()},"Auto generate Open Graph tags"),this.autoUpdateData()&&m("div",{className:"ManagedText"},m("i",{className:"fas fa-check"})," Managed")))),this.enableCustomOpenGraph&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Open Graph title")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("input",{className:"FormControl",bidi:this.openGraphTitle,placeholder:this.metaTitle(),disabled:this.autoUpdateData()})))),this.enableCustomOpenGraph&&m("div",{className:"SeoItemContainer"},m("div",{className:"SeoItemInfo"},m("div",{class:"SeoItemInfo-title"},"Open Graph description")),m("div",{className:"SeoItemContent"},m("div",{className:"ManagedContainer"},m("textarea",{className:"FormControl",bidi:this.openGraphDescription,placeholder:"Custom Twitter description",disabled:this.autoUpdateData()})))))),m("div",{style:"padding: 25px 30px; text-align: center;"},this.closeInfoText&&m("div",{style:"margin-bottom: 15px; font-size: 12px;"},m("b",null,"Note:")," ",this.closeInfoText),this.closeDialogButton()))}returnFoFUploadButton(t){var e,a,o;let i=null;const s=null==(e=flarum.extensions)?void 0:e["fof-upload"],n=null==s||null==(a=s.components)?void 0:a.Uploader,l=null==s||null==(o=s.components)?void 0:o.FileManagerModal;if("fof-upload"in flarum.extensions&&app.forum.attribute("fof-upload.canUpload")&&n&&l){const e=new n;i=m(r(),{class:"UploadButton Button",onclick:async()=>{app.modal.show(l,{uploader:e,onSelect:e=>{const a=app.store.getById("files",e[0]);t(a.url()),this.updateHasChanges()}},!0)}},"Upload file")}return i}returnTag(t,e,a){return m("div",{className:C("SeoTag",!t&&"SeoTagDisabled")},t?e:a)}closeDialogButton(){return m(r(),{type:"submit",className:"Button Button--primary",loading:this.loading},this.closeText)}updateHasChanges(){this.closeText=!this.wasManaged&&this.autoUpdateData()?"Save & auto-fill":"Save",!this.wasManaged&&this.autoUpdateData()&&(this.closeInfoText="This change will revert custom changes and fill the meta-tags with item-data."),this.hasChanges=!0}submitData(){let t={};var e,a,o,i,s,n,r,m,l;return t.autoUpdateData=this.autoUpdateData(),t.title=this.metaTitle(),t.description=this.description(),""!==this.keywords()&&(t.keywords=null!=(e=this.keywords())?e:null),t.robotsNoindex=this.robotsNoindex(),t.robotsNofollow=this.robotsNofollow(),t.robotsNoarchive=this.robotsNoarchive(),t.robotsNoimageindex=this.robotsNoimageindex(),t.robotsNosnippet=this.robotsNosnippet(),""!==this.twitterTitle()&&(t.twitterTitle=null!=(a=this.twitterTitle())?a:null),""!==this.twitterDescription()&&(t.twitterDescription=null!=(o=this.twitterDescription())?o:null),""!==this.twitterImage()&&(t.twitterImage=this.twitterImage()),"auto"!==this.twitterImageSource()&&(t.twitterImageSource=null!=(i=this.twitterImageSource())?i:null),""!==this.openGraphTitle()&&(t.openGraphTitle=null!=(s=this.openGraphTitle())?s:null),""!==this.openGraphDescription()&&(t.openGraphDescription=null!=(n=this.openGraphDescription())?n:null),""!==this.openGraphImage()&&(t.openGraphImage=null!=(r=this.openGraphImage())?r:null),"auto"!==this.openGraphImageSource()&&(t.openGraphImageSource=null!=(m=this.openGraphImageSource())?m:null),""!==this.estimatedReadingTime()&&(t.estimatedReadingTime=null!=(l=this.estimatedReadingTime())?l:null),t}onsubmit(t){t.preventDefault(),this.hasChanges?(this.loading=!0,this.meta.save(this.submitData()).then((()=>{app.alerts.show({type:"success"},"Saved!"),this.hide()})).catch((t=>{console.log(t)})).then((()=>{this.saving=!1,m.redraw()}))):this.hide()}onsaved(){this.hide()}}flarum.reg.add("vadkuz-flarum2-seo","common/Components/MetaSeoModal",x);const y=flarum.reg.get("core","common/Model");var D=t.n(y);const M=flarum.reg.get("core","common/utils/mixin");var G=t.n(M);class U extends(G()(D(),{objectType:D().attribute("objectType"),objectId:D().attribute("objectId"),autoUpdateData:D().attribute("autoUpdateData"),title:D().attribute("title"),description:D().attribute("description"),keywords:D().attribute("keywords"),robotsNoindex:D().attribute("robotsNoindex"),robotsNofollow:D().attribute("robotsNofollow"),robotsNoarchive:D().attribute("robotsNoarchive"),robotsNoimageindex:D().attribute("robotsNoimageindex"),robotsNosnippet:D().attribute("robotsNosnippet"),twitterTitle:D().attribute("twitterTitle"),twitterDescription:D().attribute("twitterDescription"),twitterImage:D().attribute("twitterImage"),twitterImageSource:D().attribute("twitterImageSource"),openGraphTitle:D().attribute("openGraphTitle"),openGraphDescription:D().attribute("openGraphDescription"),openGraphImage:D().attribute("openGraphImage"),openGraphImageSource:D().attribute("openGraphImageSource"),estimatedReadingTime:D().attribute("estimatedReadingTime"),createdAt:D().attribute("createdAt"),updatedAt:D().attribute("updatedAt")})){apiEndpoint(){return"/seo_meta"+(this.exists?"/"+this.data.id:"")}}flarum.reg.add("vadkuz-flarum2-seo","common/Models/SeoMeta",U);const k=flarum.reg.get("core","common/models/Discussion");var j=t.n(k);const O={MetaSeoModal:x};o().initializers.add("vadkuz-flarum2-seo",(()=>{(0,l.extend)(s(),"moderationControls",(function(t,e){o().forum.attribute("canConfigureSeo")&&t.add("manageSeo",r().component({icon:"fas fa-search",onclick:()=>o().modal.show(x,{objectType:"discussions",objectId:e.id()})},o().translator.trans("vadkuz-flarum2-seo.forum.controls.configure_seo")),-1e3)})),o().store.models.seoMeta=U,j().prototype.seoMeta=D().hasOne("seoMeta")}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map